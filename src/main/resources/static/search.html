<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HibiscusSearch ç®¡ç†ç•Œé¢</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
</head>


<body class="bg-gradient-to-r from-purple-600 via-indigo-700 to-blue-800 min-h-screen text-gray-100">

<div class="container mx-auto py-12 px-8 max-w-screen-xl">

    <!-- Header -->
    <header class="text-center py-8 mb-12 bg-gradient-to-r from-purple-600 via-indigo-700 to-blue-800 text-white rounded-xl shadow-2xl">
        <h1 class="text-5xl font-bold">HibiscusSearch</h1>
        <p class="text-lg mt-2">é«˜æ•ˆçš„æœç´¢å¼•æ“ç®¡ç†ç•Œé¢ (åŸºäºLucene)</p>
    </header>

    <!-- Main Content -->
    <div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-8">

        <!-- Search Section -->
        <div class="bg-white p-8 rounded-2xl shadow-lg space-y-8">
            <h2 class="text-2xl font-semibold text-gray-900">ğŸ” æœç´¢åŠŸèƒ½</h2>
            <div class="space-y-6">
                <div class="space-y-2">
                    <label for="searchQuery" class="text-sm font-medium text-black">æœç´¢å…³é”®è¯:</label>
                    <input type="text" id="searchQuery" class="w-full p-4 border text-black rounded-xl shadow-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="è¯·è¾“å…¥æœç´¢å…³é”®è¯...">
                </div>
                <div class="space-y-2">
                    <label for="searchPage" class="text-sm font-medium text-black">é¡µç :</label>
                    <input type="number" id="searchPage" value="1" min="1" class="w-full p-4 border text-black rounded-xl shadow-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                </div>
                <div class="space-y-2">
                    <label for="searchPageSize" class="text-sm font-medium text-black">æ¯é¡µå¤§å°:</label>
                    <input type="number" id="searchPageSize" value="10" min="1" max="100" class="w-full p-4 border text-black rounded-xl shadow-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                </div>
                <div class="flex space-x-6">
                    <button class="w-full bg-indigo-600 text-white py-3 rounded-xl shadow-md hover:bg-indigo-700 transition duration-300" onclick="search()">æœç´¢</button>
                    <button class="w-full bg-gray-200 text-indigo-600 py-3 rounded-xl shadow-md hover:bg-gray-300 transition duration-300" onclick="getSuggestions()">è·å–å»ºè®®</button>
                </div>
            </div>
            <div id="searchResults" class="mt-6"></div>
            <div id="suggestions" class="mt-6"></div>
        </div>

        <!-- Index Management Section -->
        <div class="bg-white p-8 rounded-2xl shadow-lg space-y-8">
            <h2 class="text-2xl font-semibold text-gray-900">ğŸ“ ç´¢å¼•ç®¡ç†</h2>
            <div class="space-y-6">
                <div class="space-y-2">
                    <label for="docId" class="text-sm font-medium text-black">æ–‡æ¡£ID:</label>
                    <input type="text" id="docId" class="w-full p-4 border text-black rounded-xl shadow-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="è¯·è¾“å…¥æ–‡æ¡£ID">
                </div>
                <div class="space-y-2">
                    <label for="docTitle" class="text-sm font-medium text-black">æ–‡æ¡£æ ‡é¢˜:</label>
                    <input type="text" id="docTitle" class="w-full p-4 border text-black rounded-xl shadow-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="è¯·è¾“å…¥æ–‡æ¡£æ ‡é¢˜">
                </div>
                <div class="space-y-2">
                    <label for="docContent" class="text-sm font-medium text-black">æ–‡æ¡£å†…å®¹:</label>
                    <textarea id="docContent" rows="6" class="w-full p-4 border text-black rounded-xl shadow-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none" placeholder="è¯·è¾“å…¥æ–‡æ¡£å†…å®¹"></textarea>
                </div>
                <div class="flex space-x-6">
                    <button class="w-full bg-green-600 text-white py-3 rounded-xl shadow-md hover:bg-green-700 transition duration-300" onclick="indexDocument()">ç´¢å¼•æ–‡æ¡£</button>
                    <button class="w-full bg-red-600 text-white py-3 rounded-xl shadow-md hover:bg-red-700 transition duration-300" onclick="deleteDocument()">åˆ é™¤æ–‡æ¡£</button>
                </div>
            </div>
        </div>

        <!-- Index Statistics Section -->
        <div class="bg-white p-8 rounded-2xl shadow-lg space-y-8">
            <h2 class="text-2xl font-semibold text-gray-900">ğŸ“Š ç´¢å¼•ç»Ÿè®¡</h2>
            <div class="space-x-6">
                <button class="w-full bg-blue-600 text-white py-3 rounded-xl shadow-md hover:bg-blue-700 transition duration-300" onclick="getStats()">è·å–ç»Ÿè®¡ä¿¡æ¯</button>
                <button class="w-full bg-gray-200 text-blue-600 py-3 rounded-xl shadow-md hover:bg-gray-300 transition duration-300" onclick="getHealth()">è·å–å¥åº·çŠ¶æ€</button>
                <button class="w-full bg-gray-200 text-blue-600 py-3 rounded-xl shadow-md hover:bg-gray-300 transition duration-300" onclick="checkOptimization()">æ£€æŸ¥ä¼˜åŒ–</button>
                <button class="w-full bg-green-600 text-white py-3 rounded-xl shadow-md hover:bg-green-700 transition duration-300" onclick="optimizeIndex()">ä¼˜åŒ–ç´¢å¼•</button>
                <button class="w-full bg-red-600 text-white py-3 rounded-xl shadow-md hover:bg-red-700 transition duration-300" onclick="clearIndex()">æ¸…ç©ºç´¢å¼•</button>
            </div>
            <div id="statsGrid" class="mt-6 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </div>

    </div>

    <!-- Message Area -->
    <div id="messageArea" class="mt-12"></div>

</div>

<script>
    const API_BASE = 'http://localhost:8080/api/search';

    // æ˜¾ç¤ºæ¶ˆæ¯
    function showMessage(message, type = 'success') {
        const messageArea = document.getElementById('messageArea');
        messageArea.innerHTML = `<div class="p-4 mb-4 text-sm text-${type === 'error' ? 'red' : 'green'}-800 bg-${type === 'error' ? 'red' : 'green'}-100 rounded-lg" role="alert">
                <span class="font-medium">${message}</span>
            </div>`;
        setTimeout(() => { messageArea.innerHTML = ''; }, 5000);
    }

    // æœç´¢åŠŸèƒ½
    async function search() {
        const query = document.getElementById('searchQuery').value;
        const page = document.getElementById('searchPage').value;
        const pageSize = document.getElementById('searchPageSize').value;

        if (!query.trim()) {
            showMessage('è¯·è¾“å…¥æœç´¢å…³é”®è¯', 'error');
            return;
        }

        try {
            const response = await fetch(`${API_BASE}/search?query=${encodeURIComponent(query)}&page=${page}&pageSize=${pageSize}`);
            const result = await response.json();
            displaySearchResults(result);
        } catch (error) {
            showMessage('æœç´¢å¤±è´¥: ' + error.message, 'error');
        }
    }

    // æ˜¾ç¤ºæœç´¢ç»“æœ
    function displaySearchResults(result) {
        const resultsDiv = document.getElementById('searchResults');
        if (result.hits.length === 0) {
            resultsDiv.innerHTML = '<div class="text-center text-gray-600">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³ç»“æœ</div>';
            return;
        }

        let html = `<h3 class="text-lg font-semibold text-gray-800 mb-4">æ‰¾åˆ° ${result.totalHits} ä¸ªç»“æœ (è€—æ—¶: ${result.searchTime}ms)</h3>`;
        result.hits.forEach(hit => {
            html += `<div class="bg-white p-4 rounded-lg shadow-md mb-4">
                            <h4 class="text-xl font-semibold text-gray-800">${hit.highlightedTitle || hit.title}</h4>
                            <p class="text-gray-600">${hit.highlightedContent || hit.content}</p>
                            <p class="mt-2 text-blue-500 font-semibold">è¯„åˆ†: ${hit.score.toFixed(2)}</p>
                        </div>`;
        });

        resultsDiv.innerHTML = html;
    }

    // è·å–æœç´¢å»ºè®®
    async function getSuggestions() {
        const query = document.getElementById('searchQuery').value;
        if (!query.trim()) {
            showMessage('è¯·è¾“å…¥æœç´¢å…³é”®è¯', 'error');
            return;
        }

        try {
            const response = await fetch(`${API_BASE}/suggest?query=${encodeURIComponent(query)}`);
            const suggestions = await response.json();
            displaySuggestions(suggestions);
        } catch (error) {
            showMessage('è·å–å»ºè®®å¤±è´¥: ' + error.message, 'error');
        }
    }

    // æ˜¾ç¤ºæœç´¢å»ºè®®
    function displaySuggestions(suggestions) {
        const suggestionsDiv = document.getElementById('suggestions');
        if (suggestions.length === 0) {
            suggestionsDiv.innerHTML = '<div class="text-center text-gray-600">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³å»ºè®®</div>';
            return;
        }

        let html = '<h4 class="text-xl font-semibold text-gray-800 mb-4">æœç´¢å»ºè®®:</h4>';
        suggestions.forEach(suggestion => {
            html += `<button class="bg-gray-100 text-blue-500 px-4 py-2 rounded-lg hover:bg-gray-200" onclick="useSuggestion('${suggestion}')">${suggestion}</button>`;
        });

        suggestionsDiv.innerHTML = html;
    }

    // ä½¿ç”¨å»ºè®®
    function useSuggestion(suggestion) {
        document.getElementById('searchQuery').value = suggestion;
        search();
    }

    // ç´¢å¼•æ–‡æ¡£
    async function indexDocument() {
        const id = document.getElementById('docId').value;
        const title = document.getElementById('docTitle').value;
        const content = document.getElementById('docContent').value;

        if (!id || !title || !content) {
            showMessage('è¯·å¡«å†™å®Œæ•´çš„æ–‡æ¡£ä¿¡æ¯', 'error');
            return;
        }

        try {
            const response = await fetch(`${API_BASE}/index`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    id: id,
                    title: title,
                    content: content,
                    timestamp: Date.now()
                })
            });

            const result = await response.text();
            showMessage(result);

            // æ¸…ç©ºè¡¨å•
            document.getElementById('docId').value = '';
            document.getElementById('docTitle').value = '';
            document.getElementById('docContent').value = '';
        } catch (error) {
            showMessage('ç´¢å¼•æ–‡æ¡£å¤±è´¥: ' + error.message, 'error');
        }
    }

    // åˆ é™¤æ–‡æ¡£
    async function deleteDocument() {
        const id = document.getElementById('docId').value;
        if (!id) {
            showMessage('è¯·è¾“å…¥è¦åˆ é™¤çš„æ–‡æ¡£ID', 'error');
            return;
        }

        if (!confirm(`ç¡®å®šè¦åˆ é™¤æ–‡æ¡£ ${id} å—ï¼Ÿ`)) {
            return;
        }

        try {
            const response = await fetch(`${API_BASE}/documents/${id}`, {
                method: 'DELETE'
            });
            const result = await response.text();
            showMessage(result);
            document.getElementById('docId').value = '';
        } catch (error) {
            showMessage('åˆ é™¤æ–‡æ¡£å¤±è´¥: ' + error.message, 'error');
        }
    }

    // è·å–ç»Ÿè®¡ä¿¡æ¯
    async function getStats() {
        try {
            const response = await fetch(`${API_BASE}/stats`);
            const stats = await response.json();
            displayStats(stats);
        } catch (error) {
            showMessage('è·å–ç»Ÿè®¡ä¿¡æ¯å¤±è´¥: ' + error.message, 'error');
        }
    }

    // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
    function displayStats(stats) {
        const statsGrid = document.getElementById('statsGrid');
        statsGrid.innerHTML = `
            <div class="bg-white p-4 rounded-lg shadow-md">
                <div class="text-xl font-bold text-gray-800">${stats.numDocs}</div>
                <div class="text-gray-600">æ–‡æ¡£æ•°é‡</div>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-md">
                <div class="text-xl font-bold text-gray-800">${stats.maxDoc}</div>
                <div class="text-gray-600">æœ€å¤§æ–‡æ¡£ID</div>
            </div>`;
    }

    // è·å–å¥åº·çŠ¶æ€
    async function getHealth() {
        try {
            const response = await fetch(`${API_BASE}/health`);
            const health = await response.json();
            showMessage(`å¥åº·çŠ¶æ€: ${health.status}, æ–‡æ¡£æ•°: ${health.numDocs}, åˆ é™¤æ–‡æ¡£æ•°: ${health.deletedDocs}`);
        } catch (error) {
            showMessage('è·å–å¥åº·çŠ¶æ€å¤±è´¥: ' + error.message, 'error');
        }
    }

    // æ£€æŸ¥ä¼˜åŒ–
    async function checkOptimization() {
        try {
            const response = await fetch(`${API_BASE}/optimization/check`);
            const result = await response.json();
            if (result.needsOptimization) {
                showMessage('ç´¢å¼•éœ€è¦ä¼˜åŒ–ï¼Œå»ºè®®æ‰§è¡Œä¼˜åŒ–æ“ä½œ', 'error');
            } else {
                showMessage('ç´¢å¼•çŠ¶æ€è‰¯å¥½ï¼Œæ— éœ€ä¼˜åŒ–');
            }
        } catch (error) {
            showMessage('æ£€æŸ¥ä¼˜åŒ–çŠ¶æ€å¤±è´¥: ' + error.message, 'error');
        }
    }

    // ä¼˜åŒ–ç´¢å¼•
    async function optimizeIndex() {
        if (!confirm('ç¡®å®šè¦ä¼˜åŒ–ç´¢å¼•å—ï¼Ÿè¿™å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ã€‚')) {
            return;
        }

        try {
            const response = await fetch(`${API_BASE}/index/optimize`, {
                method: 'POST'
            });
            const result = await response.text();
            showMessage(result);
        } catch (error) {
            showMessage('ä¼˜åŒ–ç´¢å¼•å¤±è´¥: ' + error.message, 'error');
        }
    }

    // æ¸…ç©ºç´¢å¼•
    async function clearIndex() {
        if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰ç´¢å¼•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
            return;
        }

        try {
            const response = await fetch(`${API_BASE}/index`, {
                method: 'DELETE'
            });
            const result = await response.text();
            showMessage(result);
        } catch (error) {
            showMessage('æ¸…ç©ºç´¢å¼•å¤±è´¥: ' + error.message, 'error');
        }
    }

    // é¡µé¢åŠ è½½æ—¶è·å–ç»Ÿè®¡ä¿¡æ¯
    window.onload = function () {
        getStats();
    };
</script>
</body>

</html>
