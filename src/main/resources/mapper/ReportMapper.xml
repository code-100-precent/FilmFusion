<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.cxdproject.coder.mapper.ReportMapper">

    <resultMap id="BaseResultMap" type="cn.cxdproject.coder.model.entity.Report">
        <id column="id" property="id" />
        <result column="name" property="name" />
        <result column="type" property="type" />
        <result column="genre" property="genre" />
        <result column="episodes" property="episodes" />
        <result column="invest_amount" property="investAmount" />
        <result column="main_creators" property="mainCreators" />
        <result column="lead_producer" property="leadProducer" />
        <result column="producer_unit" property="producerUnit" />
        <result column="start_date" property="startDate" />
        <result column="end_date" property="endDate" />
        <result column="crew_scale" property="crewScale" />
        <result column="contact" property="contact" />
        <result column="phone_number" property="phoneNumber" />
        <result column="crew_position" property="crewPosition" />
        <result column="user_id" property="userId" />
        <result column="deleted" property="deleted" />
        <result column="created_at" property="createdAt" />
        <result column="updated_at" property="updatedAt" />
        <result column="status" property="status" />
        <result column="shoot_permit" property="shootPermit" />
        <result column="thumb_shoot_permit" property="thumbShootPermit" />
        <result column="approval_file" property="approvalFile" />
        <result column="thumb_approval_file" property="thumbApprovalFile" />
        <result column="shoot_apply" property="shootApply" />
        <result column="thumb_shoot_apply" property="thumbShootApply" />
    </resultMap>

    <sql id="Base_Column_List">
            `id`,
            `name`,
            `type`,
            `genre`,
            `episodes`,
            `invest_amount`,
            `main_creators`,
            `lead_producer`,
            `producer_unit`,
            `start_date`,
            `end_date`,
            `crew_scale`,
            `contact`,
            `phone_number`,
            `crew_position`,
            `user_id`,
            `deleted`,
            `created_at`,
            `updated_at`,
            'status',
            `shoot_permit`,
            `thumb_shoot_permit`,
            `approval_file`,
            `thumb_approval_file`,
            `shoot_apply`,
            `thumb_shoot_apply`
    </sql>

    <select id="selectMyPage" resultType="cn.cxdproject.coder.model.entity.Report">
        SELECT r.*
        FROM fi_reports r
                 INNER JOIN (
            SELECT id
            FROM fi_reports
            WHERE user_id = #{userId}
              AND deleted = 0
            ORDER BY id ASC
                LIMIT #{offset}, #{size}
        ) tmp ON r.id = tmp.id
    </select>

    <select id="selectPageByAdmin" resultType="cn.cxdproject.coder.model.entity.Report">
        SELECT *
        FROM fi_reports
        WHERE deleted = 0
        <if test="keyword != null and keyword != ''">
            AND (
            name LIKE CONCAT('%', #{keyword}, '%')
            OR type LIKE CONCAT('%', #{keyword}, '%')
            )
        </if>
        ORDER BY id ASC
        LIMIT #{offset}, #{size}
    </select>

    <update id="updateReportByUser">
        UPDATE fi_reports
        <set>
            <if test="dto.name != null and dto.name != ''">
                name = #{dto.name},
            </if>
            <if test="dto.type != null and dto.type != ''">
                type = #{dto.type},
            </if>
            <if test="dto.genre != null and dto.genre != ''">
                genre = #{dto.genre},
            </if>
            <if test="dto.episodes != null and dto.episodes != ''">
                episodes = #{dto.episodes},
            </if>
            <if test="dto.investAmount != null and dto.investAmount != ''">
                invest_amount = #{dto.investAmount},
            </if>
            <if test="dto.mainCreators != null and dto.mainCreators != ''">
                main_creators = #{dto.mainCreators},
            </if>
            <if test="dto.leadProducer != null and dto.leadProducer != ''">
                lead_producer = #{dto.leadProducer},
            </if>
            <if test="dto.producerUnit != null and dto.producerUnit != ''">
                producer_unit = #{dto.producerUnit},
            </if>
            <if test="dto.startDate != null and dto.startDate != ''">
                start_date = #{dto.startDate},
            </if>
            <if test="dto.endDate != null and dto.endDate != ''">
                end_date = #{dto.endDate},
            </if>
            <if test="dto.crewScale != null and dto.crewScale != ''">
                crew_scale = #{dto.crewScale},
            </if>
            <if test="dto.contact != null and dto.contact != ''">
                contact = #{dto.contact},
            </if>
            <if test="dto.phoneNumber != null and dto.phoneNumber != ''">
                phone_number = #{dto.phoneNumber},
            </if>
            <if test="dto.crewPosition != null and dto.crewPosition != ''">
                crew_position = #{dto.crewPosition},
            </if>
            <if test="dto.shootPermit != null and dto.shootPermit != ''">
                shoot_permit = #{dto.shootPermit},
            </if>
            <if test="dto.thumbShootPermit != null and dto.thumbShootPermit != ''">
                thumb_shoot_permit = #{dto.thumbShootPermit},
            </if>
            <if test="dto.approvalFile != null and dto.approvalFile != ''">
                approval_file = #{dto.approvalFile},
            </if>
            <if test="dto.thumbApprovalFile != null and dto.thumbApprovalFile != ''">
                thumb_approval_file = #{dto.thumbApprovalFile},
            </if>
            <if test="dto.shootApply != null and dto.shootApply != ''">
                shoot_apply = #{dto.shootApply},
            </if>
            <if test="dto.thumbShootApply != null and dto.thumbShootApply != ''">
                thumb_shoot_apply = #{dto.thumbShootApply},
            </if>
        </set>
        WHERE id = #{id}
        AND deleted = false
    </update>

    <update id="updateReportByAdmin">
        UPDATE fi_reports
        SET
            status = #{status}
        WHERE id = #{id}
          AND deleted = false
    </update>


</mapper>
